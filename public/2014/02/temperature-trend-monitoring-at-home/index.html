<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Temperature trend monitoring at home &middot; golb </title>

  
  <link rel="stylesheet" href="http://localhost:1313/css/poole.css">
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:1313/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="golb" />
</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>golb</h1>
      <p class="lead">
        Espen Braastad
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
    </ul>
  </div>
</div>


    <div class="content container">
<div class="post">
  <h1>Temperature trend monitoring at home</h1>
  <span class="post-date">Wed, Feb 19, 2014</span>
      <p>Background
I’ve got balanced ventilation in my apartment. It works OK, but I don’t fully understand how it behaves if knobs are pushed and pots are turned, and I’m definitely not sure if its performance is as good as I should expect.</p>

<p>I’m going to do some measurements to see how the system reacts to changes in the outside temperature and tuning of the various settings. The first parameter to measure is the temperature in the air intake, exhaust air and some of the ventilation valves in the different rooms in the apartment.</p>

<p>Hardware
Some temperature sensors are required. Price is an important factor, but so is accuracy. I settled with some sensors from the USBTenki project. Schematics and software are open source, so you can assemble the sensors yourself if you want to. I didn’t want to, so I bought them ready to run from Dracal.</p>

<p><img src="/img/usbtenki_sensor_on_table.png" alt="Sensor" />
</p>

<pre><code>±0.5°C typical accuracy at 25°C
±1°C (max.) accuracy from -10°C to +85°C
±2°C (max.) accuracy from -10°C to +125°C
±3°C (max.) accuracy from -55°C to +125°C
</code></pre>

<p>The price is 29.99$ CAD per sensor and they ship internationally. I bought five sensors. In addition, I bought some USB extension cords and a cheap bus powered USB hub from Deal Extreme to allow all sensors to be connected simultaneously.</p>

<p>Software
Munin will be used to create graphs to show the temperature over time:</p>

<p>Munin is a networked resource monitoring tool that can help analyze resource trends and “what just happened to kill our performance?” problems. It is designed to be very plug and play. A default installation provides a lot of graphs with almost no work.
Munin is written in Perl and is available in the repositories of most Linux distributions. Installation is easy:</p>

<pre><code># Fedora / Redhat / CentOS
sudo yum install munin munin-node

# Debian / Ubuntu
sudo apt-get install munin munin-node
</code></pre>

<p>USBTenki host software is used to communicate with the sensors from Linux.</p>

<p>Setup
A couple of the sensors are mounted in the ventilation tubes for permanent monitoring, and the other ones are used for temporary monitoring at various locations.</p>

<p><img src="/img/usbtenki_sensor_mounted.png" alt="Sensor" />
</p>

<p>Since the number of sensors and the locations will vary, I need a munin plugin that is flexible. I wrote a simple multigraph plugin that will detect new sensors and create a new graph per sensor that is added. These graphs are completely standardised and (frankly) pretty boring:</p>

<p><img src="/img/sensor_905270-week.png" alt="Sensor" />

<img src="/img/sensor_E10084-week.png" alt="Sensor" />

<img src="/img/sensor_E10087-week.png" alt="Sensor" />
</p>

<p>Data loaning is used to aggregate the different sensor data and to modify their presentation (type, colour, label, etc) as I see fit, without having to modify the plugin itself. This will ensure that old sensor data is kept whenever modifications are made, and the data from each sensor can be used in multiple aggregated graphs if needed.</p>

<p>Data loaning configuration example and result:</p>

<pre><code>[sensor;ventilation]
    address 127.0.0.1
    use_node_name no
    temp.update no
    temp.graph_title Temperature
    temp.graph_args --base 1000
    temp.graph_vlabel Celcius
    temp.graph_scale no
    temp.graph_category temperature
    temp.graph_order \
        E10084=oslo;caesar:sensor_E10084.output \
        E10090=oslo;caesar:sensor_E10090.output \
        E10087=oslo;caesar:sensor_E10087.output 
    temp.E10084.draw LINE1
    temp.E10084.colour FF00FF
    temp.E10084.label Air exhaust (inside)
    temp.E10087.draw LINE1
    temp.E10087.colour FF0000
    temp.E10087.label Air intake (outside)
    temp.E10090.draw LINE1
    temp.E10090.colour 00FF00
    temp.E10090.label Air intake (inside)
</code></pre>

<p><img src="/img/temp-week.png" alt="Aggregated, by week" />
</p>

<p><img src="/img/temp-day.png" alt="Aggregated, by day" />
</p>

<p>Air flow, carbon dioxide, humidity and power consumption are other aspects that are interesting to monitor as well, but those will have to wait until I find reasonably priced sensors with satisfying accuracy and quality.</p>

</div>
</div>

  <script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
